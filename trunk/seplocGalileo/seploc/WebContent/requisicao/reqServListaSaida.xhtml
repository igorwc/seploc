<ui:composition xmlns="http://www.worg/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:t="http://myfaces.apache.org/tomahawk"
	template="../templatepage/masterpage.xhtml">

	<!-- TAXINOMIA -->
	<ui:define name="taxinomia">
		<h:outputText value="#{msgs.tax_reqserv_root}" />
		<img src="../imgs/ponto.png" />
		<h:outputText value="#{msgs.tax_reqserv_lista}" />
	</ui:define>

	<!-- CONTEUDO -->
	<ui:define name="conteudo">
<style type="text/css">
.row1 {
	background-color: #EEF3E2;
	font-size: 10px;
}

.row2 {
	background-color: #ffffff;
	font-size: 10px;
}

.col1 {
	text-align: center;
}

.texto {
	font-family: arial, tahoma;
	font-size: 10pt;
	color: #00008B;
}
.tituloCampo {
	font-family: arial, tahoma;
	font-size: 8pt;
	color: #000000;
}
.error {
	font-weight: bold;
	font-style: normal;
	color: #FF0000;
	font-size: 8pt;
	font-family: tahoma, arial;
}
.scrollerCell {
	padding-right: 10px;
	padding-left: 10px;
	height: 15pt;
}

.formulario,.formulario TD,.formulario TH {
	background-color: #f2f2f5;
}
</style>

		<f:view>
			<h:form id="reqServList" enctype="UTF-8" prependId="false">

				<rich:panel header="Requisicao de Servico">

					<!-- Formulario -->
					<center><rich:panel	header="Procurar Requisicoes de Servico" 
										style="width: 1000px"										
										id="reqServFiltros">
						<table border="0">
							<tr align="left">
								<td width="100px"><h:outputText value="Requisicao: " styleClass="texto" /></td>
								<td width="250px"><h:outputText value="Cliente: " styleClass="texto" /></td>
								<td width="250px"><h:outputText value="Projeto: " styleClass="texto" /></td>								
								<td width="100px"><h:outputText value="Motoqueiro: " styleClass="texto" /></td>								
								<td width="150px"><h:outputText value="Data Inicio: " styleClass="texto" /></td>
								<td width="150px"><h:outputText value="Data Fim: " styleClass="texto" /></td>
							</tr>
							<tr>
								<td><h:inputText value="#{reqServListaSaidaCB.reqServSaidasMB.reqServico.numReq}" 
												 id="numReq"
												 size="10">
										<a4j:support event="onChange" reRender="reqServListTodos"/>
									</h:inputText></td>
								<td><h:inputText value="#{reqServListaSaidaCB.reqServSaidasMB.cliente.fantasia}" 
								         id="cliente" 
								         readonly="true"
								         size="30"
								         />
								    <a4j:commandLink ajaxSingle="true" 
												 id="modaleditcli" 
												 oncomplete="#{rich:component('modalCliente')}.show();return false;">
										<h:graphicImage value="/imgs/botao-editar.png" style="border:0" />					
									</a4j:commandLink></td>
								<td valign="top"><h:inputText value="#{reqServListaSaidaCB.reqServSaidasMB.projeto.projeto}"									 						 
										 id="projeto" 										 
										 size="30"
										 readonly="true"/>										 
									<a4j:commandLink ajaxSingle="true" 
						   						 id="editlinkproj" 
												 oncomplete="#{rich:component('modalProjeto')}.show();return false;">
										<h:graphicImage value="/imgs/botao-editar.png" style="border:0" />					
									</a4j:commandLink></td>									
								<td>
									<h:selectOneMenu value="#{reqServListaSaidaCB.reqServSaidasMB.cobrador}" id="cobrador">
					                                <f:selectItem itemLabel="Selecione" itemValue="-1"></f:selectItem>
					                                <t:selectItems value="#{reqServListaSaidaCB.reqServSaidasMB.todosCobradores}"
					                                			   var="cobrador" 
					                                               itemLabel="#{cobrador.nome}" 
					                                               itemValue="#{cobrador.codCobrador}" />					                                	                    			
				                    			</h:selectOneMenu></td>								
								<td>
	                                <rich:calendar value="#{reqServListaSaidaCB.reqServSaidasMB.dataInicio}"
	                                           locale="#{reqServListaSaidaCB.locale}"
	                                           popup="true"
	                                           datePattern="dd/MM/yyyy"
	                                           showApplyButton="false" 
	                                           cellWidth="15px" 
	                                           cellHeight="22px" 
	                                           style="block:inline">
	                                           <f:convertDateTime pattern="dd/MM/yyyy" type="date" />
	                                           <a4j:support event="onchanged" action="#{reqServListaSaidaCB.validateDatas}" reRender="dataInvalidaMsg,reqServListTodos" />
	                                </rich:calendar></td>
	                            <td>
	                                <h:selectOneMenu value="#{reqServListaSaidaCB.reqServSaidasMB}" id="papel">
					                                <f:selectItem itemLabel="Selecione" itemValue="-1"></f:selectItem>
					                                <t:selectItems value="#{reqServClienteCB.reqServMB.todosPapeis}"
					                                			   var="papel" 
					                                               itemLabel="#{papel.nome}" 
					                                               itemValue="#{papel.codPapel}" />					                                	                    			
				                    			</h:selectOneMenu></td>
								<td>
	                                <rich:calendar value="#{reqServListaSaidaCB.reqServSaidasMB.dataFim}"
	                                           locale="#{reqServListaSaidaCB.locale}"
	                                           popup="true"
	                                           datePattern="dd/MM/yyyy"
	                                           showApplyButton="false" 
	                                           cellWidth="15px" 
	                                           cellHeight="22px" 
	                                           style="block:inline" >
	                                           <f:convertDateTime pattern="dd/MM/yyyy" type="date" />
	                                           <a4j:support event="onchanged" action="#{reqServListaSaidaCB.validateDatas}" reRender="dataInvalidaMsg,reqServListTodos" />
	                                </rich:calendar></td>
							</tr>
							<tr>
								<td></td>
								<td></td>
								<td></td>
								<td colspan="2">
									<a4j:outputPanel id="dataInvalidaMsg">
                                		<h:outputText value="#{reqServListaSaidaCB.datasInvalidasMsg}" 
                                					  rendered="#{reqServListaSaidaCB.reqServSaidasMB.datasInvalidas}" 
                                					  styleClass="error"/>
                                	</a4j:outputPanel></td>
							</tr>
							<tr>
								<td colspan="5" align="center">
								<!-- Botoes --> 
								<a4j:commandButton
									value="Atualizar Registro"
									action="#{reqServListaSaidaCB.reqServSaidasMB.cadastrar}"
									reRender="reqServFiltros,reqServListTodos"/>
								<rich:spacer width="5px"/>								
								<a4j:commandButton
									value="Pesquisar Numero Requisicao"
									action="#{reqServListaSaidaCB.reqServSaidasMB.pesquisar}"
									reRender="reqServFiltros,reqServListTodos"/>
								<rich:spacer width="5px"/>									
								<a4j:commandButton
									value="Iniciar Datas"
									action="#{reqServListaSaidaCB.reqServSaidasMB.datasInvalidas}"
									reRender="reqServFiltros,reqServListTodos"/>
								<rich:spacer width="5px"/>
								<a4j:commandButton
									value="#{msgs['botao.limpar']}"
									action="#{reqServListaSaidaCB.reqServSaidasMB.limpar}"
									reRender="reqServFiltros,reqServListTodos"/>																		
								</td>
							</tr>
						</table>

					</rich:panel></center>
					<!-- fim Formulario -->
					
					
					
			<!-- Modal Projeto -->
			<rich:modalPanel id="modalProjeto" autosized="true" width="300" height="300">
				<f:facet name="header" >
					<h:outputText value="Busca Projeto" style="padding-right:15px;" />
				</f:facet>
				<f:facet name="controls">
					<h:panelGroup>
						<h:graphicImage value="/imgs/icons/close.png" id="hidemodalproj" />
						<rich:componentControl for="modalProjeto" attachTo="hidemodalproj" 
						operation="hide" event="onclick" />
					</h:panelGroup>
				</f:facet>
				<h:form>
					<rich:dataTable value="#{reqServListaSaidaCB.reqServSaidasMB.todosProjetos}" var="proj" rows="10"
						reRender="dsProjeto" id="simpletable" >
						<f:facet name="header">
							<rich:columnGroup>
								<rich:column colspan="4">
									<h:outputText value="Filtro de Projeto" />
								</rich:column>
								<rich:column breakBefore="true">
									<h:outputText value="CNPJ/CPF" />
								</rich:column>
								<rich:column>
									<h:outputText value="Cliente" />
								</rich:column>
								<rich:column>								
									<h:outputText value="Projeto" />
								</rich:column>
								<rich:column>							
								</rich:column>
							</rich:columnGroup>
						</f:facet>
						
						<rich:column>
							<h:outputText value="#{proj.cliente.cnpj}" />
							<h:outputText value="#{proj.cliente.cpf}" />
						</rich:column>
						<rich:column filterBy="#{proj.cliente.fantasia}" 
									 filterEvent="onkeyup">
							<h:outputText value="#{proj.cliente.fantasia}" />
						</rich:column>
						<rich:column filterBy="#{proj.projeto}" 
									 filterEvent="onkeyup"
									 filterValue="#{reqServListaSaidaCB.reqServSaidasMB.filtroProjeto}">
							<h:outputText value="#{proj.projeto}" />
						</rich:column>					
						
						<rich:column styleClass="col1">
							<a4j:commandLink ajaxSingle="true" 
								                 id="edtlinkproj" 
							    				 reRender="reqServList,modalProjeto" 
							    				 oncomplete=" #{rich:component('modalProjeto')}.hide();"
							    				 >
								<h:graphicImage value="/imgs/botao-editar.png" style="border:0" />
		
								<f:setPropertyActionListener value="#{proj}"
										target="#{reqServListaSaidaCB.reqServSaidasMB.projeto}" />
							</a4j:commandLink>
						</rich:column>  
						<f:facet name="footer">
							<rich:datascroller id="dsProjeto" renderIfSinglePage="true"></rich:datascroller>
						</f:facet>
					</rich:dataTable>	
				</h:form>
			</rich:modalPanel>		   

			<!-- Modal Cliente -->
			<rich:modalPanel id="modalCliente" autosized="true" width="300" height="300">
				<f:facet name="header" >
					<h:outputText value="Busca Cliente" style="padding-right:15px;" />
				</f:facet>
				<f:facet name="controls">
					<h:panelGroup>
						<h:graphicImage value="/imgs/icons/close.png" id="hidemodalcli" />
						<rich:componentControl for="modalCliente" attachTo="hidemodalcli" 
						operation="hide" event="onclick" />
					</h:panelGroup>
				</f:facet>
				<h:form>
					<rich:dataTable value="#{appBean.listaClientes}" var="cli" rows="10"
						reRender="dsCliente" id="simpletable" >
						<f:facet name="header">
							<rich:columnGroup>
								<rich:column colspan="3">
									<h:outputText value="Filtro de Cliente" />
								</rich:column>
								<rich:column breakBefore="true">
									<h:outputText value="CNPJ/CPF" />
								</rich:column>
								<rich:column>
									<h:outputText value="Cliente" />
								</rich:column>
								<rich:column>							
								</rich:column>
							</rich:columnGroup>
						</f:facet>
						
						<rich:column>
							<h:outputText value="#{cli.cnpj}" />
							<h:outputText value="#{cli.cpf}" />
						</rich:column>
						<rich:column filterBy="#{cli.fantasia}" 
									 filterEvent="onkeyup"
									 filterValue="#{reqServListaSaidaCB.reqServSaidasMB.filtroCliente}" >
							<h:outputText value="#{cli.fantasia}" />
						</rich:column>
						
						<rich:column styleClass="col1">
							<a4j:commandLink ajaxSingle="true" 
								                 id="editlinkcli" 
							    				 reRender="reqServList,modalCliente" 
							    				 oncomplete=" #{rich:component('modalCliente')}.hide();"
							    				 >
								<h:graphicImage value="/imgs/botao-editar.png" style="border:0" />
		
								<f:setPropertyActionListener value="#{cli}"
										target="#{reqServListaSaidaCB.reqServSaidasMB.cliente}" />
							</a4j:commandLink>
						</rich:column>  
						<f:facet name="footer">
							<rich:datascroller id="dsCliente" renderIfSinglePage="true"></rich:datascroller>
						</f:facet>
					</rich:dataTable>	
				</h:form>
			</rich:modalPanel>
			
	      	<!-- Confirmacao -->
	        <rich:modalPanel id="confirmationMessage" autosized="true" width="200">
	        <f:facet name="header">
	            <h:outputText value="Requisicao de Servicos"
	                style="padding-right:15px;" />
	        </f:facet>
	        <f:facet name="controls">
	            <h:panelGroup>
	                <h:graphicImage value="/imgs/icons/close.png"
	                    styleClass="hidelink" id="hidelink2" />
	                <rich:componentControl for="deletePanel" attachTo="hidelink2"
	                    operation="hide" event="onclick" />
	            </h:panelGroup>
	        </f:facet>
	        <h:form>
	            <table width="100%">
	                <tbody>
	                    <tr>
	                        <td align="center" width="100%">
	                           	<rich:messages   showDetail="false" showSummary="true" styleClass="texto"/>
	                        </td>
	                    </tr>
	                    <tr>
	                        <td align="center" width="100%"><a4j:commandButton
	                            value="OK"
	                            onclick="#{rich:component('confirmationMessage')}.hide();return false;" />
	                        </td>
	                    </tr>
	                </tbody>
	            </table>
	        </h:form>
	    </rich:modalPanel>					
					
				</rich:panel>
			</h:form>
		</f:view>
	</ui:define>

</ui:composition>

